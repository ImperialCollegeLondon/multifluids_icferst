<?xml version="1.0" encoding="UTF-8" ?>

<testproblem>
  <name>k_epsilon_scalar_diffusivity</name>
  <owner userid="sp911"/>
  <tags>flml sediment k-epsilon test</tags>
  <problem_definition length="medium" nprocs="1">
    <command_line>fluidity k_epsilon_scalar_diffusivity.flml</command_line>
    <!-- Check that the sediment re-entrainment rate is correct -->
</problem_definition>
  <variables>   
    <variable name="diff_error" language="python">

from fluidity_tools import stat_parser
from numpy import *

s = stat_parser("k_epsilon_scalar_diffusivity.stat")   
eddy_visc = s["Fluid"]["EddyViscosity%11"]["max"] 
temp_diff = array([s["Fluid"]["TemperatureDiffusivity%11"]["max"]])
bg_diff = 1e-7
Pr = 0.5

expected_diff = array([bg_diff + eddy_visc/Pr])

error = abs((temp_diff - expected_diff)/expected_diff)
diff_error = error.max()

    </variable>  
  </variables>
  <pass_tests>
      <!-- diffusioni is as expected -->
    <test name="Scalar field diffusion is as expected, error less than 0.0001%" language="python">
assert(diff_error &lt; 0.000001)
    </test>
  </pass_tests>
  <warn_tests>
  </warn_tests>
</testproblem>
