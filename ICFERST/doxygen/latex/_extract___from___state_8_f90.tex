\hypertarget{_extract___from___state_8_f90}{}\doxysection{/home/psalinas/\+Documents/workspace/\+Multi\+Fluids\+\_\+\+Dev/\+I\+C\+F\+E\+R\+S\+T/src/\+Extract\+\_\+\+From\+\_\+\+State.F90 File Reference}
\label{_extract___from___state_8_f90}\index{/home/psalinas/Documents/workspace/MultiFluids\_Dev/ICFERST/src/Extract\_From\_State.F90@{/home/psalinas/Documents/workspace/MultiFluids\_Dev/ICFERST/src/Extract\_From\_State.F90}}
{\ttfamily \#include \char`\"{}fdebug.\+h\char`\"{}}\newline
Include dependency graph for Extract\+\_\+\+From\+\_\+\+State.\+F90\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=229pt]{_extract___from___state_8_f90__incl}
\end{center}
\end{figure}
\doxysubsection*{Modules}
\begin{DoxyCompactItemize}
\item 
module \mbox{\hyperlink{namespacecopy__outof__state}{copy\+\_\+outof\+\_\+state}}
\end{DoxyCompactItemize}
\doxysubsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_ab5c876f8f241119d1dedc0bffa8fa159}{copy\+\_\+outof\+\_\+state\+::get\+\_\+primary\+\_\+scalars\+\_\+new}} (state, Mdims)
\begin{DoxyCompactList}\small\item\em This subroutine extracts all primary variables associated with the mesh from state, and associated them with the variables used in the Multi\+Fluids model. \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_abba0b467480d0b56c11d18f70e8c680e}{copy\+\_\+outof\+\_\+state\+::compute\+\_\+node\+\_\+global\+\_\+numbers}} (state, ndgln)
\begin{DoxyCompactList}\small\item\em This subroutine calculates the global node numbers requested to operates in the M\+P-\/space. \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_a25e9236f15044530da105400e0e3e3f4}{copy\+\_\+outof\+\_\+state\+::get\+\_\+ele\+\_\+type}} (x\+\_\+nloc, cv\+\_\+ele\+\_\+type, p\+\_\+ele\+\_\+type, u\+\_\+ele\+\_\+type, mat\+\_\+ele\+\_\+type, u\+\_\+sele\+\_\+type, cv\+\_\+sele\+\_\+type)
\begin{DoxyCompactList}\small\item\em \+: Obtain the type of element u\+\_\+ele\+\_\+type = cv\+\_\+ele\+\_\+type = p\+\_\+ele\+\_\+type will flag the dimension and type of element\+: = 1 or 2\+: 1D (linear and quadratic, respectively) -\/N\+OT S\+U\+P\+P\+O\+R\+T\+E\+D-\/ = 3 or 4\+: triangle (linear or quadratic, respectively) = 5 or 6\+: quadrilateral (bi-\/linear or tri-\/linear, respectively)-\/N\+OT S\+U\+P\+P\+O\+R\+T\+E\+D-\/ = 7 or 8\+: tetrahedron (linear or quadratic, respectively) = 9 or 10\+: hexahedron (bi-\/linear or tri-\/linear, respectively) -\/N\+OT S\+U\+P\+P\+O\+R\+T\+E\+D-\/ \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_aed2618045311aa635b4b0bd2599ab609}{copy\+\_\+outof\+\_\+state\+::get\+\_\+ele\+\_\+type\+\_\+new}} (Mdims, Mdisopt)
\begin{DoxyCompactList}\small\item\em \+: Obtains the element type Mdisoptu\+\_\+ele\+\_\+type = Mdisoptcv\+\_\+ele\+\_\+type = Mdisoptp\+\_\+ele\+\_\+type will flag the dimension and type of element\+: = 1 or 2\+: 1D (linear and quadratic, respectively) -\/N\+OT S\+U\+P\+P\+O\+R\+T\+E\+D-\/ = 3 or 4\+: triangle (linear or quadratic, respectively) = 5 or 6\+: quadrilateral (bi-\/linear or tri-\/linear, respectively) -\/N\+OT S\+U\+P\+P\+O\+R\+T\+E\+D-\/ = 7 or 8\+: tetrahedron (linear or quadratic, respectively) = 9 or 10\+: hexahedron (bi-\/linear or tri-\/linear, respectively) -\/N\+OT S\+U\+P\+P\+O\+R\+T\+E\+D-\/ \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_add060a0a644c1d8db9c718a82d89c852}{copy\+\_\+outof\+\_\+state\+::get\+\_\+discretisation\+\_\+options}} (state, Mdims, Mdisopt)
\begin{DoxyCompactList}\small\item\em \+: This subroutine extract all discretisation options from the schema D\+I\+S\+O\+PT Options\+: =0 1st order in space Theta=specified U\+N\+I\+V\+E\+R\+S\+AL =1 1st order in space Theta=non-\/linear U\+N\+I\+V\+E\+R\+S\+AL =2 Trapezoidal rule in space Theta=specified U\+N\+I\+V\+E\+R\+S\+AL =2 if isotropic limiter then F\+E\+M-\/quadratic \& stratification adjust. Theta=non-\/linear =3 Trapezoidal rule in space Theta=non-\/linear U\+N\+I\+V\+E\+R\+S\+AL =4 Finite elements in space Theta=specified U\+N\+I\+V\+E\+R\+S\+AL =5 Finite elements in space Theta=non-\/linear U\+N\+I\+V\+E\+R\+S\+AL =6 Finite elements in space Theta=specified N\+O\+NE =7 Finite elements in space Theta=non-\/linear N\+O\+NE =8 Finite elements in space Theta=specified D\+O\+W\+N\+W\+I\+N\+D+\+I\+N\+T\+E\+R\+F\+A\+CE T\+R\+A\+C\+K\+I\+NG =9 Finite elements in space Theta=non-\/linear D\+O\+W\+N\+W\+I\+N\+D+\+I\+N\+T\+E\+R\+F\+A\+CE T\+R\+A\+C\+K\+I\+NG \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_ab4280b302a2f45375be2df118ed6d100}{copy\+\_\+outof\+\_\+state\+::update\+\_\+boundary\+\_\+conditions}} (state, stotel, cv\+\_\+snloc, nphase, suf\+\_\+t\+\_\+bc, suf\+\_\+t\+\_\+bc\+\_\+rob1, suf\+\_\+t\+\_\+bc\+\_\+rob2, tracer)
\begin{DoxyCompactList}\small\item\em \+: Sets the boundary condition, if the time has advance and the B\+Cs changed, here they are set to the new time-\/level \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_afca89971343f6586b89f1cddda00b2c8}{copy\+\_\+outof\+\_\+state\+::pack\+\_\+multistate}} (npres, state, packed\+\_\+state, multiphase\+\_\+state, multicomponent\+\_\+state, pmulti\+\_\+state)
\begin{DoxyCompactList}\small\item\em \+: This subroutine creates packed\+\_\+state from state(\+:) and links the appropiate memory so it is acessible from both states. This subroutine also introduces fields not used by fludity but required by I\+C-\/\+F\+E\+R\+ST \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_adba75f9a3f64d519ecf58b2b9159d629}{copy\+\_\+outof\+\_\+state\+::prepare\+\_\+absorptions}} (state, Mdims, multi\+\_\+absorp)
\begin{DoxyCompactList}\small\item\em \+: Prepares the memory to compute absorption fields \end{DoxyCompactList}\item 
type(vector\+\_\+field) function, public \mbox{\hyperlink{namespacecopy__outof__state_abfa3817b7e0890e5009c4905376a5688}{copy\+\_\+outof\+\_\+state\+::as\+\_\+vector}} (tfield, dim, slice)
\begin{DoxyCompactList}\small\item\em \+: This function points a tensor field as a vector field type This is necessary when solving for tensor fields that are actually multiphase vector fields. \end{DoxyCompactList}\item 
type(vector\+\_\+field) function, public \mbox{\hyperlink{namespacecopy__outof__state_a6bc946977b60a10ae77f86013eb499e7}{copy\+\_\+outof\+\_\+state\+::as\+\_\+packed\+\_\+vector}} (tfield)
\begin{DoxyCompactList}\small\item\em \+: This function points a tensor field as a vector field type This is necessary when solving for tensor fields that are actually multiphase vector fields. \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_a60ec84623fb582762f2139794470ba13}{copy\+\_\+outof\+\_\+state\+::finalise\+\_\+multistate}} (packed\+\_\+state, multiphase\+\_\+state, multicomponent\+\_\+state)
\begin{DoxyCompactList}\small\item\em \+: Destrys packed\+\_\+state and the passed down states \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_a577c504f5230ff200ee711334eebe54a}{copy\+\_\+outof\+\_\+state\+::adaptive\+\_\+nonlinear}} (Mdims, packed\+\_\+state, reference\+\_\+field, its, Repeat\+\_\+time\+\_\+step, Exit\+Non\+Linear\+Loop, non\+Linear\+Adapt\+Ts, old\+\_\+acctim, order, calculate\+\_\+mass\+\_\+delta, adapt\+\_\+mesh\+\_\+in\+\_\+\+F\+PI, Accum\+\_\+\+Courant, Courant\+\_\+tol, Current\+\_\+\+Courant, first\+\_\+time\+\_\+step)
\begin{DoxyCompactList}\small\item\em \+: This subroutine either store variables before the nonlinear timeloop starts, or checks how the nonlinear iterations are going and depending on that increase the timestep or decreases the timestep and repeats that timestep \end{DoxyCompactList}\item 
real function, public \mbox{\hyperlink{namespacecopy__outof__state_ad775c010bade229fba0416002e6928a6}{copy\+\_\+outof\+\_\+state\+::inf\+\_\+norm\+\_\+scalar\+\_\+normalised}} (tracer, reference\+\_\+tracer, dumping, totally\+\_\+min\+\_\+max)
\begin{DoxyCompactList}\small\item\em Calculate the inf norm of the normalised field, so the field goes from 0 to 1. \end{DoxyCompactList}\item 
real function, public \mbox{\hyperlink{namespacecopy__outof__state_a7d6957a54cc1cc0a38a4a7a90bca1f89}{copy\+\_\+outof\+\_\+state\+::get\+\_\+convergence\+\_\+functional}} (phasevolumefraction, reference\+\_\+sat, dumping, its)
\begin{DoxyCompactList}\small\item\em \+: We create a potential to optimize F = sum (f$\ast$$\ast$2), so the solution is when this potential reaches a minimum. Typically the value to consider convergence is the sqrt(epsilon of the machine), i.\+e. 10$^\wedge$-\/8 f = (New\+Sat-\/\+Old\+Sat)/\+Number of nodes; this is the typical approach for algebraic non linear systems \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_a0520a99d915a669f52eadab9a438194b}{copy\+\_\+outof\+\_\+state\+::get\+\_\+var\+\_\+from\+\_\+packed\+\_\+state}} (packed\+\_\+state, F\+E\+Density, Old\+F\+E\+Density, Iterated\+F\+E\+Density, Density, Old\+Density, Iterated\+Density, Phase\+Volume\+Fraction, Old\+Phase\+Volume\+Fraction, Iterated\+Phase\+Volume\+Fraction, Velocity, Old\+Velocity, Iterated\+Velocity, F\+E\+Phase\+Volume\+Fraction, Old\+F\+E\+Phase\+Volume\+Fraction, Iterated\+F\+E\+Phase\+Volume\+Fraction, Nonlinear\+Velocity, Old\+Nonlinear\+Velocity, Iterated\+Nonlinear\+Velocity, Component\+Density, Old\+Component\+Density, Iterated\+Component\+Density, Component\+Mass\+Fraction, Old\+Component\+Mass\+Fraction, Temperature, Old\+Temperature, Iterated\+Temperature, F\+E\+Temperature, Old\+F\+E\+Temperature, Iterated\+F\+E\+Temperature, Iterated\+Component\+Mass\+Fraction, F\+E\+Component\+Density, Old\+F\+E\+Component\+Density, Iterated\+F\+E\+Component\+Density, F\+E\+Component\+Mass\+Fraction, Old\+F\+E\+Component\+Mass\+Fraction, Iterated\+F\+E\+Component\+Mass\+Fraction, Pressure, F\+E\+Pressure, Old\+F\+E\+Pressure, C\+V\+Pressure, Old\+C\+V\+Pressure, C\+V\+\_\+\+Immobile\+\_\+\+Fraction, Coordinate, Velocity\+Coordinate, Pressure\+Coordinate, Material\+Coordinate, Cap\+Pressure, Immobile\+\_\+fraction, End\+Point\+Relperm, Relperm\+Exponent, Cap\+\_\+entry\+\_\+pressure, Cap\+\_\+exponent, Imbibition\+\_\+term, Concentration, Old\+Concentration, Iterated\+Concentration, F\+E\+Concentration, Old\+F\+E\+Concentration, Iterated\+F\+E\+Concentration, Enthalpy, Old\+Enthalpy, Iterated\+Enthalpy, F\+E\+Enthalpy, Old\+F\+E\+Enthalpy, Iterated\+F\+E\+Enthalpy)
\begin{DoxyCompactList}\small\item\em @\+D\+E\+P\+R\+E\+C\+A\+T\+ED\+: Gets memory from packed state \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_a5fa62e07eab3607bcf414b67abe1148a}{copy\+\_\+outof\+\_\+state\+::printcsrmatrix}} (Matrix, find, col, dim\+\_\+same\+\_\+row)
\begin{DoxyCompactList}\small\item\em \+: Subroutine to print C\+SR matrix by (row, column) Dimensions and phases are printed in different rows So for example Matrix(2,2,10) with two rows would be presented as a matrix ( 8 x 10) \end{DoxyCompactList}\item 
logical function, public \mbox{\hyperlink{namespacecopy__outof__state_ab7c981b328d9950b1c375aaacaa3cda0}{copy\+\_\+outof\+\_\+state\+::is\+\_\+constant}} (tfield)
\begin{DoxyCompactList}\small\item\em \+: Checks whether a field is constant or not \end{DoxyCompactList}\item 
character(len=field\+\_\+name\+\_\+len) function, public \mbox{\hyperlink{namespacecopy__outof__state_abc850cced2fb9b525f015e758e4b45da}{copy\+\_\+outof\+\_\+state\+::getoldname}} (tfield)
\begin{DoxyCompactList}\small\item\em \+: For a given field, retrieve the associated old field name \end{DoxyCompactList}\item 
character(len=field\+\_\+name\+\_\+len) function, public \mbox{\hyperlink{namespacecopy__outof__state_ac1305d6f3dc1c1ec92a4135ea55947b9}{copy\+\_\+outof\+\_\+state\+::getfemname}} (tfield)
\begin{DoxyCompactList}\small\item\em \+: For a given field, retrieve the associated finite element field name \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_a1394fdd5e9adcc149eb319739c07f854}{copy\+\_\+outof\+\_\+state\+::calculate\+\_\+internal\+\_\+volume}} (packed\+\_\+state, Mdims, mass\+\_\+ele, calculate\+\_\+mass, cv\+\_\+ndgln, D\+E\+N\+\_\+\+A\+LL, eles\+\_\+with\+\_\+pipe)
\begin{DoxyCompactList}\small\item\em \+: Subroutine to calculate the integrated mass inside the domain \end{DoxyCompactList}\item 
logical function, public \mbox{\hyperlink{namespacecopy__outof__state_acea2acdccf9091776be013ade24bcd97}{copy\+\_\+outof\+\_\+state\+::have\+\_\+option\+\_\+for\+\_\+any\+\_\+phase}} (path, nphase)
\begin{DoxyCompactList}\small\item\em \+: Subroutine to check whether an option is true for any phase in diamond, if any is true it returns true. The path must be the part of the path inside the phase, i.\+e. /multiphase\+\_\+properties/capillary\+\_\+pressure \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_a2a2f72be9cad756d2151473988566c8d}{copy\+\_\+outof\+\_\+state\+::get\+\_\+darcyvelocity}} (Mdims, ndgln, state, packed\+\_\+state, upwnd)
\begin{DoxyCompactList}\small\item\em \+: This subroutine calculates the actual Darcy velocity, but with P0\+DG precision \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_adbfe914b0d919d92535a188ab7c0e384}{copy\+\_\+outof\+\_\+state\+::dump\+\_\+outflux}} (current\+\_\+time, itime, outfluxes)
\begin{DoxyCompactList}\small\item\em \+: Subroutine that dumps the total flux at a given timestep across all specified boundaries to a file called \textquotesingle{}simulation\+\_\+name\+\_\+outfluxes.\+csv\textquotesingle{}. In addition, the time integrated flux up to the current timestep is also outputted to this file. Integration boundaries are specified in diamond via surface\+\_\+ids. (In diamond this option can be found under \char`\"{}/io/dump\+\_\+boundaryflux/surface\+\_\+ids\char`\"{} and the user should specify an integer array containing the I\+Ds of every boundary they wish to integrate over). \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_a3e466dfb76c8c3e30de12d2f7d36d3bb}{copy\+\_\+outof\+\_\+state\+::update\+\_\+outfluxes}} (bcs\+\_\+outfluxes, outfluxes, sele, cv\+\_\+nodi, suf\+\_\+area, Vol\+\_\+flux, Mass\+\_\+flux, tracer, outfluxes\+\_\+fields, start\+\_\+phase, end\+\_\+phase)
\begin{DoxyCompactList}\small\item\em \+: Updates the outfluxes information based on N\+D\+O\+T\+Q\+N\+EW, shape functions and transported fields for a given GI point in a certain element This subroutine should only be called if S\+E\+LE is on the B\+O\+U\+N\+D\+A\+RY Example of Mass\+\_\+flux\+: ndotq(iphase) $\ast$ Sdev\+FunsD\+E\+T\+W\+EI(gi) $\ast$ L\+I\+M\+D\+T(iphase) Example of Vol\+\_\+flux\+: ndotq(iphase) $\ast$ Sdev\+FunsD\+E\+T\+W\+EI(gi) $\ast$ L\+I\+M\+D\+T(iphase) \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_a6c5000c06758c4e42744252542c849cb}{copy\+\_\+outof\+\_\+state\+::enterforcebalanceequation}} (Enter\+Solve, its, itime, acctim, t\+\_\+adapt\+\_\+threshold, after\+\_\+adapt, after\+\_\+adapt\+\_\+itime, P\+V\+F\+\_\+cfl)
\begin{DoxyCompactList}\small\item\em \+:--A Subroutine that returns a Logical, either to Enter the Force Balance Eqs or Not = given a requested\+\_\+cfl\+\_\+pressure it will skip the Force\+Balance\+Equation that many times = while if I have adaptive mesh it will solve the Force\+Balance\+Equation after each adapt\+\_\+time\+\_\+steps = The Subroutive also account for delaying adaptivity and swich between cfl\+\_\+pressure and after\+\_\+adapt= \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespacecopy__outof__state_a52b4659aa8636bb70d12b05923bc58b8}{copy\+\_\+outof\+\_\+state\+::impose\+\_\+connected\+\_\+bcs}} (outfluxes, packed\+\_\+state, Mdims, acctime)
\begin{DoxyCompactList}\small\item\em \+: Using the outfluxes values, it imposes as BC the averaged value of another B\+C(from within the domain) It is a basic method to get this functionality but it will work in parallel. However, it does not guarantee mass conservation as it uses the value from the previous time-\/step although it can still be used for many cases such as A\+T\+ES, or ventilation. Overwrites the dirichlet BC values. \end{DoxyCompactList}\end{DoxyCompactItemize}
