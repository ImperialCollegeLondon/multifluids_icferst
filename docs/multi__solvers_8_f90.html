<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ICFERST: /home/mbahlali/Softwares/MultiFluids_Dev_master_ubuntu24_new/ICFERST/src/multi_solvers.F90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="IC_FERST_Logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">ICFERST<span id="projectnumber">&#160;25-11</span>
   </div>
   <div id="projectbrief">Reservoir simulator based on DCVFEM, Dynamic Mesh optimisation and Surface-based modelling</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('multi__solvers_8_f90.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#namespaces">Modules</a> &#124;
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle"><div class="title">multi_solvers.F90 File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;fdebug.h&quot;</code><br />
<code>#include &quot;petsc/finclude/petsc.h&quot;</code><br />
<code>#include &quot;petsc_legacy.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for multi_solvers.F90:</div>
<div class="dyncontent">
<div class="center"><img src="multi__solvers_8_f90__incl.png" border="0" usemap="#a_2home_2mbahlali_2_softwares_2_multi_fluids___dev__master__ubuntu24__new_2_i_c_f_e_r_s_t_2src_2multi__solvers_8_f90" alt=""/></div>
<map name="a_2home_2mbahlali_2_softwares_2_multi_fluids___dev__master__ubuntu24__new_2_i_c_f_e_r_s_t_2src_2multi__solvers_8_f90" id="a_2home_2mbahlali_2_softwares_2_multi_fluids___dev__master__ubuntu24__new_2_i_c_f_e_r_s_t_2src_2multi__solvers_8_f90">
<area shape="rect" title=" " alt="" coords="87,5,293,75"/>
<area shape="rect" title=" " alt="" coords="5,123,84,148"/>
<area shape="poly" title=" " alt="" coords="139,77,76,117,73,113,136,73"/>
<area shape="rect" title=" " alt="" coords="109,123,271,148"/>
<area shape="poly" title=" " alt="" coords="193,75,193,109,187,109,187,75"/>
<area shape="rect" title=" " alt="" coords="295,123,413,148"/>
<area shape="poly" title=" " alt="" coords="251,72,323,113,320,118,248,77"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="namespaces" name="namespaces"></a>
Modules</h2></td></tr>
<tr class="memitem:namespacesolvers__module" id="r_namespacesolvers__module"><td class="memItemLeft" align="right" valign="top">module &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesolvers__module.html">solvers_module</a></td></tr>
<tr class="memdesc:namespacesolvers__module"><td class="mdescLeft">&#160;</td><td class="mdescRight">All the subroutines associated to solving non-linear systems, Schur complement, etc. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ac9869d27925198c5c3a95232b79cbb97" id="r_ac9869d27925198c5c3a95232b79cbb97"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesolvers__module.html#ac9869d27925198c5c3a95232b79cbb97">solvers_module::boundedsolutioncorrections</a> (state, packed_state, mdims, cv_funs, small_findrm, small_colm, field_name, for_sat, min_max_limits)</td></tr>
<tr class="memdesc:ac9869d27925198c5c3a95232b79cbb97"><td class="mdescLeft">&#160;</td><td class="mdescRight">The sparcity of the local CV connectivity is in: small_findrm, small_colm. ngl_its=max no of global iterations e.g. 100. error_tol = tolerance on the iterations.  <br /></td></tr>
<tr class="separator:ac9869d27925198c5c3a95232b79cbb97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6838cee9b9a7eb08de040686134a9ed" id="r_aa6838cee9b9a7eb08de040686134a9ed"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesolvers__module.html#aa6838cee9b9a7eb08de040686134a9ed">solvers_module::fpi_backtracking</a> (nphase, mdims, ndgln, state, packed_state, sat_bak, backtrack_sat, backtrack_par_from_schema, previous_convergence, satisfactory_convergence, new_backtrack_par, max_sat_its, its, nonlinear_iteration, useful_sats, res, res_ratio, first_res)</td></tr>
<tr class="memdesc:aa6838cee9b9a7eb08de040686134a9ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">:In this subroutine we applied some corrections and backtrack_par on the saturations obtained from the saturation equation this subroutine is detailed in Salinas et al. 2017 doi:10.1002/fld.4357 The method ensures convergence "independent" of the time step.  <br /></td></tr>
<tr class="separator:aa6838cee9b9a7eb08de040686134a9ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bba1ef1495c1a4a47a7eea3f2c17719" id="r_a9bba1ef1495c1a4a47a7eea3f2c17719"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesolvers__module.html#a9bba1ef1495c1a4a47a7eea3f2c17719">solvers_module::set_saturation_to_sum_one</a> (mdims, packed_state, state, do_not_update_halos)</td></tr>
<tr class="memdesc:a9bba1ef1495c1a4a47a7eea3f2c17719"><td class="mdescLeft">&#160;</td><td class="mdescRight">:This subroutines eliminates the oscillations in the saturation that are bigger than a certain tolerance and also sets the saturation to be between bounds  <br /></td></tr>
<tr class="separator:a9bba1ef1495c1a4a47a7eea3f2c17719"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f0983ff761cbc960353cd6850ce0835" id="r_a5f0983ff761cbc960353cd6850ce0835"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesolvers__module.html#a5f0983ff761cbc960353cd6850ce0835">solvers_module::non_porous_ensure_sum_to_one</a> (mdims, packed_state, do_not_update_halos)</td></tr>
<tr class="memdesc:a5f0983ff761cbc960353cd6850ce0835"><td class="mdescLeft">&#160;</td><td class="mdescRight">: This subroutines eliminates the oscillations in the saturation that are bigger than a certain tolerance and also sets the saturation to be between bounds  <br /></td></tr>
<tr class="separator:a5f0983ff761cbc960353cd6850ce0835"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85646e595797edceed6d3be72173ef7f" id="r_a85646e595797edceed6d3be72173ef7f"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesolvers__module.html#a85646e595797edceed6d3be72173ef7f">solvers_module::initialise_saturation_sums_one</a> (mdims, packed_state, find_scapegoat_phase)</td></tr>
<tr class="memdesc:a85646e595797edceed6d3be72173ef7f"><td class="mdescLeft">&#160;</td><td class="mdescRight">:Ensure that the saturations at the beginning sum to one, if they do not all the error is compensated in the scapegoat_phase. Normally the last  <br /></td></tr>
<tr class="separator:a85646e595797edceed6d3be72173ef7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75f714580dc6fc01b865dd5533aa81c8" id="r_a75f714580dc6fc01b865dd5533aa81c8"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesolvers__module.html#a75f714580dc6fc01b865dd5533aa81c8">solvers_module::auto_backtracking</a> (mdims, backtrack_par_factor, courant_number_in, first_time_step, nonlinear_iteration, i_am_temperature)</td></tr>
<tr class="memdesc:a75f714580dc6fc01b865dd5533aa81c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">: The maximum backtracking factor is calculated based on the Courant number and physical effects ocurring in the domain  <br /></td></tr>
<tr class="separator:a75f714580dc6fc01b865dd5533aa81c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ad917af46abb89b45e944c720205d25" id="r_a9ad917af46abb89b45e944c720205d25"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesolvers__module.html#a9ad917af46abb89b45e944c720205d25">solvers_module::get_anderson_acceleration_new_guess</a> (n, m, newfield, history_field, stored_residuals, max_its, prev_small_matrix, restart_now)</td></tr>
<tr class="memdesc:a9ad917af46abb89b45e944c720205d25"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine provides a new guess based on previous updates and residuals. Use this subroutine to speed up any system being solved by looping. A new guess is computed and returned Method explained in DOI.10.1137/10078356X.  <br /></td></tr>
<tr class="separator:a9ad917af46abb89b45e944c720205d25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed9753359fd3dd4278721035ca8c0134" id="r_aed9753359fd3dd4278721035ca8c0134"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesolvers__module.html#aed9753359fd3dd4278721035ca8c0134">solvers_module::scale_petsc_matrix_by_vector</a> (mat_petsc, vfield)</td></tr>
<tr class="memdesc:aed9753359fd3dd4278721035ca8c0134"><td class="mdescLeft">&#160;</td><td class="mdescRight">In this subroutine the matrix is multiplied by vfield A is-written.  <br /></td></tr>
<tr class="separator:aed9753359fd3dd4278721035ca8c0134"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c699fc13a99bfd2473ee1c229452938" id="r_a9c699fc13a99bfd2473ee1c229452938"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesolvers__module.html#a9c699fc13a99bfd2473ee1c229452938">solvers_module::scale_petsc_matrix</a> (mat_petsc)</td></tr>
<tr class="memdesc:a9c699fc13a99bfd2473ee1c229452938"><td class="mdescLeft">&#160;</td><td class="mdescRight">In this subroutine the matrix is re-scaled based on the formula D^-0.5 * A * D^-0.5 X'= D^-0.5 b; and next X = D^-0.5 * X'; IMPORTANT: the step X = D^-0.5 * X' needs to be done elsewhere store the diagonal before calling this This should allow to deal with high ranges of viscosity ratio for example A is-written.  <br /></td></tr>
<tr class="separator:a9c699fc13a99bfd2473ee1c229452938"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d8537381fc47d2c768d80375889a65a" id="r_a6d8537381fc47d2c768d80375889a65a"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesolvers__module.html#a6d8537381fc47d2c768d80375889a65a">solvers_module::duplicate_petsc_matrix</a> (mat_a, mat_b)</td></tr>
<tr class="separator:a6d8537381fc47d2c768d80375889a65a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22222ae8924d0c67a163ee7b01cb00e1" id="r_a22222ae8924d0c67a163ee7b01cb00e1"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesolvers__module.html#a22222ae8924d0c67a163ee7b01cb00e1">solvers_module::petsc_stokes_solver</a> (packed_state, mdims, mmat, ndgln, mspars, final_phase, pmat, p_all, deltap, rhs_p, solver_option_path, dmat)</td></tr>
<tr class="memdesc:a22222ae8924d0c67a163ee7b01cb00e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">In this subroutine the Schur complement is generated and solved using PETSc to update the pressure field Matrices need to be in petsc format and pmat is the preconditioned matrix, i.e. pmat = A11- A10(AproxA00^-1)A01.  <br /></td></tr>
<tr class="separator:a22222ae8924d0c67a163ee7b01cb00e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="multi__solvers_8_f90.html">multi_solvers.F90</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
